---
name: scientific-illustrations
description: Generate publication-ready academic illustrations using the PaperBanana agentic workflow. Orchestrates specialized agents (Planner, Stylist, Visualizer, Critic) to transform methodology descriptions into high-quality diagrams and statistical plots. Use when the user asks for academic figures, methodology diagrams, or statistical plots.
allowed-tools: Bash(gemini:*), Read, Write, Edit, Glob, Grep
---

# Scientific Illustrations — Academic Illustration Generator

Generate publication-ready academic illustrations using the PaperBanana agentic workflow (Zhu et al., 2026). Orchestrates 4 specialized agents in zero-shot mode to transform methodology descriptions into high-quality diagrams and statistical plots.

## When to Use This Skill

Use when the user:
- Asks for a methodology diagram, framework figure, or architecture illustration
- Wants a statistical plot (bar chart, line chart, heatmap, radar, etc.)
- Says "generate a figure for my paper" or similar
- Provides a methodology section + figure caption

## Prerequisites

Before first use, verify the environment:

```bash
# 1. API key must be available
source ~/.secrets
[ -n "$GEMINI_API_KEY" ] && echo "API key configured" || echo "ERROR: Missing GEMINI_API_KEY in ~/.secrets"
[ -n "${OPENROUTER_API_KEY:-}" ] && echo "Optional OpenRouter key configured" || echo "Optional: set OPENROUTER_API_KEY for text-model routing"

# 2. Nanobanana extension must be installed
gemini extensions list | grep nanobanana || echo "ERROR: Run 'gemini extensions install https://github.com/gemini-cli-extensions/nanobanana'"

# 3. Set high-quality model
export NANOBANANA_MODEL=gemini-3-pro-image-preview
export OPENROUTER_MODEL=google/gemini-2.5-pro      # Optional
```

`OPENROUTER_API_KEY` is optional and does not replace `GEMINI_API_KEY` for nanobanana image generation.

## Workflow Overview

The pipeline has two phases:

### Phase A: Linear Planning (Claude handles all reasoning)

1. **Planner Agent** — Given methodology text (S) and figure caption (C), create a comprehensive textual description (P) of the target illustration. Be as detailed as possible: describe every element, connection, color, shape, and layout.

2. **Stylist Agent** — Refine the description (P) into a stylistically optimized version (P*) using the NeurIPS 2025 aesthetic guidelines from `references/style-guide.md`. Preserve content; only enhance visual specification.

### Phase B: Iterative Refinement Loop (T=3 rounds)

3. **Visualizer Agent** — Generate the image using Gemini CLI + nanobanana:
   - For **diagrams**: `source ~/.secrets && NANOBANANA_MODEL=gemini-3-pro-image-preview gemini --yolo "/generate '<optimized_description>' --aspect=21:9"`
   - For **statistical plots**: Generate Python/matplotlib code instead, then execute it to produce the plot

4. **Critic Agent** — Evaluate the generated image against the source text (S, C) and current description (P_t). Identify factual misalignments, text errors, visual glitches. Produce a revised description (P_{t+1}).

5. **Loop**: Feed revised description back to Visualizer. Repeat for T=3 total rounds. The final output is I_T.

## Input Format

The user provides:
- **Source Context (S)**: The methodology section text describing the method
- **Communicative Intent (C)**: The figure caption specifying scope and focus

Example:
```
S: "Our framework consists of three stages: (1) feature extraction using a pretrained ResNet backbone..."
C: "Overview of our proposed multi-stage framework for visual question answering."
```

## Agent Prompts

Detailed system prompts for each agent are in `references/agent-prompts.md`. The key roles:

| Agent | Role | Model |
|-------|------|-------|
| Planner | Translate method text + caption into detailed visual description | Claude |
| Stylist | Refine description with NeurIPS aesthetic guidelines | Claude |
| Visualizer | Generate image (nanobanana) or code (matplotlib) | Gemini |
| Critic | Evaluate output, produce refined description | Claude |

## Style Guidelines

The NeurIPS 2025 aesthetic guidelines are in `references/style-guide.md`. Key principles:
- "Soft Tech & Scientific Pastels" aesthetic
- Light pastel backgrounds for zone grouping (10-15% opacity)
- Rounded rectangles for processes, 3D cuboids for tensors, cylinders for databases
- Sans-serif for labels, serif italic for math variables
- Orthogonal arrows for architectures, curved for high-level flow
- Domain-aware styling (illustrative for agent papers, minimalist for theory)

## Output

Generated images should be saved to `./projects/output/<job-name>/` in the current working directory. The `<job-name>` is either user-provided or auto-generated by slugifying the figure caption (e.g., "Overview of multi-stage framework" becomes `overview-of-multi-stage-framework`).

After generation:
1. List `./projects/output/<job-name>/` to find the latest file
2. Present the image to the user
3. Offer refinement if needed

## Diagram vs. Plot Mode

| Mode | Visualizer Behavior | Critic Focus |
|------|---------------------|--------------|
| Diagram | `gemini --yolo "/generate '...'"` | Visual fidelity, text QA, layout clarity |
| Plot | Generate matplotlib Python code | Data accuracy, axis labels, value correctness |

For plots, the Visualizer writes executable Python code. The Critic checks rendered output against raw data for numerical accuracy.

## Troubleshooting

| Problem | Solution |
|---------|----------|
| GEMINI_API_KEY not set | `source ~/.secrets` before running |
| Extension not found | `gemini extensions install https://github.com/gemini-cli-extensions/nanobanana` |
| Quota exceeded | Wait for reset or switch to flash: `export NANOBANANA_MODEL=gemini-2.5-flash-image` |
| Image too generic | Increase description detail in Planner step; be more specific about elements |
| Text garbled in image | Critic should flag this; minimize text in image, use keywords not sentences |
